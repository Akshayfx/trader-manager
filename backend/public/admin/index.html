<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChartWise Admin Dashboard</title>
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-logo">
                <i class="fas fa-chart-line"></i>
                <h1>ChartWise</h1>
                <p>Admin Dashboard</p>
            </div>
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label><i class="fas fa-user"></i> Username</label>
                    <input type="text" id="username" placeholder="Enter admin username" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="password" placeholder="Enter password" required>
                </div>
                <div class="form-options">
                    <label class="checkbox-label">
                        <input type="checkbox" id="rememberMe">
                        <span>Remember me</span>
                    </label>
                </div>
                <button type="submit" class="btn btn-primary btn-full">
                    <i class="fas fa-sign-in-alt"></i> Sign In
                </button>
            </form>
            <div id="loginError" class="login-error"></div>
        </div>
    </div>

    <!-- Dashboard (hidden until login) -->
    <div id="dashboard" class="dashboard" style="display: none;">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-chart-line"></i>
                <span>ChartWise Admin</span>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-page="overview">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Overview</span>
                </a>
                <a href="#" class="nav-item" data-page="users">
                    <i class="fas fa-users"></i>
                    <span>Users</span>
                </a>
                <a href="#" class="nav-item" data-page="subscriptions">
                    <i class="fas fa-crown"></i>
                    <span>Subscriptions</span>
                </a>
                <a href="#" class="nav-item" data-page="api">
                    <i class="fas fa-code"></i>
                    <span>API Management</span>
                </a>
                <a href="#" class="nav-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
                <a href="#" class="nav-item" data-page="logs">
                    <i class="fas fa-file-alt"></i>
                    <span>Logs</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <div class="admin-info">
                    <span id="adminName">Admin</span>
                    <small id="adminRole">Super Admin</small>
                </div>
                <button id="logoutBtn" class="btn btn-icon" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <h2 id="pageTitle">Dashboard Overview</h2>
                <div class="header-actions">
                    <div class="server-status">
                        <span class="status-dot online"></span>
                        <span>Server Online</span>
                    </div>
                    <button class="btn btn-secondary" id="refreshBtn">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </header>

            <!-- Overview Page -->
            <div id="page-overview" class="page active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon users">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="totalUsers">0</span>
                            <span class="stat-label">Total Users</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon pro">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="proUsers">0</span>
                            <span class="stat-label">Pro Users</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon enterprise">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="enterpriseUsers">0</span>
                            <span class="stat-label">Enterprise</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon connections">
                            <i class="fas fa-plug"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="activeConnections">0</span>
                            <span class="stat-label">Active Connections</span>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-bar"></i> API Usage (7 Days)</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="apiUsageChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-bell"></i> Recent Activity</h3>
                        </div>
                        <div class="card-body">
                            <div id="recentActivity" class="activity-list">
                                <!-- Activity items will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-server"></i> System Status</h3>
                    </div>
                    <div class="card-body">
                        <div class="system-status-grid">
                            <div class="status-item">
                                <span class="status-label">WebSocket Connections</span>
                                <span class="status-value" id="wsConnections">0</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">MT4 Connections</span>
                                <span class="status-value" id="mt4Connections">0</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">MT5 Connections</span>
                                <span class="status-value" id="mt5Connections">0</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Desktop Clients</span>
                                <span class="status-value" id="desktopConnections">0</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Mobile Clients</span>
                                <span class="status-value" id="mobileConnections">0</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Uptime</span>
                                <span class="status-value" id="uptime">0h 0m</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Page -->
            <div id="page-users" class="page">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-users"></i> User Management</h3>
                        <div class="header-actions">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="userSearch" placeholder="Search users...">
                            </div>
                            <select id="subscriptionFilter" class="filter-select">
                                <option value="">All Subscriptions</option>
                                <option value="free">Free</option>
                                <option value="pro">Pro</option>
                                <option value="enterprise">Enterprise</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="data-table" id="usersTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Username</th>
                                        <th>Email</th>
                                        <th>Subscription</th>
                                        <th>Trades</th>
                                        <th>Created</th>
                                        <th>Last Login</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <!-- Users will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        <div class="pagination" id="usersPagination">
                            <!-- Pagination will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Subscriptions Page -->
            <div id="page-subscriptions" class="page">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon free">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="freeSubCount">0</span>
                            <span class="stat-label">Free Users</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon pro">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="proSubCount">0</span>
                            <span class="stat-label">Pro Users</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon enterprise">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="enterpriseSubCount">0</span>
                            <span class="stat-label">Enterprise</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-crown"></i> Subscription Plans</h3>
                        <button class="btn btn-primary" id="addPlanBtn">
                            <i class="fas fa-plus"></i> Add Plan
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="data-table" id="plansTable">
                                <thead>
                                    <tr>
                                        <th>Plan Name</th>
                                        <th>Price</th>
                                        <th>Features</th>
                                        <th>Users</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="plansTableBody">
                                    <!-- Plans will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- API Management Page -->
            <div id="page-api" class="page">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-code"></i> API Configuration</h3>
                    </div>
                    <div class="card-body">
                        <div class="api-section">
                            <h4>Economic Calendar API</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Primary Provider</label>
                                    <select id="newsApiProvider" class="form-control">
                                        <option value="horizonfx">HorizonFX (RapidAPI)</option>
                                        <option value="finnhub">Finnhub</option>
                                        <option value="mock">Mock Data (Testing)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>API Key</label>
                                    <input type="password" id="newsApiKey" class="form-control" placeholder="Enter API key">
                                </div>
                            </div>
                            <div class="api-status">
                                <span class="status-label">Status:</span>
                                <span class="status-badge" id="newsApiStatus">Active</span>
                                <span class="api-usage">Usage: <span id="newsApiUsage">0</span> / 100 requests today</span>
                            </div>
                        </div>

                        <div class="api-section">
                            <h4><i class="fas fa-brain"></i> AI Service Configuration</h4>
                            <p class="section-desc">Select which AI service to use for trade analysis and reports</p>
                            
                            <div class="ai-service-options">
                                <div class="ai-service-card" data-provider="openai">
                                    <div class="service-header">
                                        <input type="radio" name="aiProvider" value="openai" id="aiOpenAI" checked>
                                        <label for="aiOpenAI">
                                            <span class="service-name">OpenAI GPT-4</span>
                                            <span class="service-desc">Best overall performance and analysis quality</span>
                                        </label>
                                    </div>
                                    <div class="service-config">
                                        <div class="form-group">
                                            <label>API Key</label>
                                            <input type="password" id="openaiApiKey" class="form-control" placeholder="sk-...">
                                        </div>
                                        <div class="form-group">
                                            <label>Model</label>
                                            <select id="openaiModel" class="form-control">
                                                <option value="gpt-4">GPT-4 (Best Quality)</option>
                                                <option value="gpt-4-turbo">GPT-4 Turbo (Faster)</option>
                                                <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Cheaper)</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="ai-service-card" data-provider="anthropic">
                                    <div class="service-header">
                                        <input type="radio" name="aiProvider" value="anthropic" id="aiAnthropic">
                                        <label for="aiAnthropic">
                                            <span class="service-name">Anthropic Claude</span>
                                            <span class="service-desc">Excellent for detailed analysis and reasoning</span>
                                        </label>
                                    </div>
                                    <div class="service-config">
                                        <div class="form-group">
                                            <label>API Key</label>
                                            <input type="password" id="anthropicApiKey" class="form-control" placeholder="sk-ant-...">
                                        </div>
                                        <div class="form-group">
                                            <label>Model</label>
                                            <select id="anthropicModel" class="form-control">
                                                <option value="claude-3-opus">Claude 3 Opus (Best)</option>
                                                <option value="claude-3-sonnet">Claude 3 Sonnet (Balanced)</option>
                                                <option value="claude-3-haiku">Claude 3 Haiku (Fast)</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="ai-service-card" data-provider="google">
                                    <div class="service-header">
                                        <input type="radio" name="aiProvider" value="google" id="aiGoogle">
                                        <label for="aiGoogle">
                                            <span class="service-name">Google Gemini</span>
                                            <span class="service-desc">Good performance with competitive pricing</span>
                                        </label>
                                    </div>
                                    <div class="service-config">
                                        <div class="form-group">
                                            <label>API Key</label>
                                            <input type="password" id="googleApiKey" class="form-control" placeholder="AIza...">
                                        </div>
                                        <div class="form-group">
                                            <label>Model</label>
                                            <select id="googleModel" class="form-control">
                                                <option value="gemini-pro">Gemini Pro</option>
                                                <option value="gemini-ultra">Gemini Ultra (Best)</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="ai-service-card" data-provider="local">
                                    <div class="service-header">
                                        <input type="radio" name="aiProvider" value="local" id="aiLocal">
                                        <label for="aiLocal">
                                            <span class="service-name">Local/Custom Model</span>
                                            <span class="service-desc">Use your own hosted model for privacy</span>
                                        </label>
                                    </div>
                                    <div class="service-config">
                                        <div class="form-group">
                                            <label>Endpoint URL</label>
                                            <input type="text" id="localEndpoint" class="form-control" placeholder="http://localhost:8080/v1/chat">
                                        </div>
                                        <div class="form-group">
                                            <label>Model Name</label>
                                            <input type="text" id="localModel" class="form-control" placeholder="llama-2-70b">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="ai-features-config">
                                <h5>AI Features</h5>
                                <div class="feature-toggles">
                                    <div class="feature-item">
                                        <span>Trade Analysis Reports</span>
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="aiTradeReports" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                    <div class="feature-item">
                                        <span>Weekly Auto-Reports</span>
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="aiWeeklyReports" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                    <div class="feature-item">
                                        <span>Monthly Auto-Reports</span>
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="aiMonthlyReports" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                    <div class="feature-item">
                                        <span>Behavior Analysis</span>
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="aiBehaviorAnalysis" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="ai-user-selection">
                                <h5>Available AI Models for Users</h5>
                                <p class="section-desc">Select which AI models users can choose from in their settings</p>
                                
                                <div class="model-availability">
                                    <div class="model-option">
                                        <label class="checkbox-item">
                                            <input type="checkbox" id="allowOpenAI" checked>
                                            <span class="checkmark"></span>
                                            <div class="model-info">
                                                <span class="model-name">OpenAI GPT-4</span>
                                                <span class="model-desc">Best overall quality</span>
                                            </div>
                                        </label>
                                    </div>
                                    <div class="model-option">
                                        <label class="checkbox-item">
                                            <input type="checkbox" id="allowAnthropic" checked>
                                            <span class="checkmark"></span>
                                            <div class="model-info">
                                                <span class="model-name">Anthropic Claude</span>
                                                <span class="model-desc">Excellent reasoning</span>
                                            </div>
                                        </label>
                                    </div>
                                    <div class="model-option">
                                        <label class="checkbox-item">
                                            <input type="checkbox" id="allowGoogle">
                                            <span class="checkmark"></span>
                                            <div class="model-info">
                                                <span class="model-name">Google Gemini</span>
                                                <span class="model-desc">Competitive pricing</span>
                                            </div>
                                        </label>
                                    </div>
                                    <div class="model-option">
                                        <label class="checkbox-item">
                                            <input type="checkbox" id="allowLocal">
                                            <span class="checkmark"></span>
                                            <div class="model-info">
                                                <span class="model-name">Local/Custom Model</span>
                                                <span class="model-desc">Privacy-focused</span>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="default-model-section">
                                    <label>Default Model for New Users</label>
                                    <select id="defaultUserModel" class="form-control">
                                        <option value="openai">OpenAI GPT-4</option>
                                        <option value="anthropic">Anthropic Claude</option>
                                        <option value="google">Google Gemini</option>
                                        <option value="local">Local/Custom</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="api-status">
                                <span class="status-label">Status:</span>
                                <span class="status-badge" id="aiApiStatus">Active</span>
                                <span class="api-usage">Reports Generated: <span id="aiReportsCount">0</span></span>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button class="btn btn-primary" id="saveApiSettings">
                                <i class="fas fa-save"></i> Save API Settings
                            </button>
                            <button class="btn btn-secondary" id="testApis">
                                <i class="fas fa-vial"></i> Test Connections
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-line"></i> API Usage Statistics</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="apiStatsChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="page-settings" class="page">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-cog"></i> System Settings</h3>
                    </div>
                    <div class="card-body">
                        <div class="settings-tabs">
                            <button class="tab-btn active" data-tab="general">General</button>
                            <button class="tab-btn" data-tab="security">Security</button>
                            <button class="tab-btn" data-tab="notifications">Notifications</button>
                        </div>

                        <div class="tab-content active" id="tab-general">
                            <div class="form-group">
                                <label>Application Name</label>
                                <input type="text" id="appName" class="form-control" value="ChartWise">
                            </div>
                            <div class="form-group">
                                <label>Maintenance Mode</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="maintenanceMode">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label>Allow New Registrations</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="allowRegistration" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="tab-content" id="tab-security">
                            <div class="form-group">
                                <label>Max Login Attempts</label>
                                <input type="number" id="maxLoginAttempts" class="form-control" value="5">
                            </div>
                            <div class="form-group">
                                <label>Session Timeout (hours)</label>
                                <input type="number" id="sessionTimeout" class="form-control" value="24">
                            </div>
                            <div class="form-group">
                                <label>Require Email Verification</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="requireEmailVerification" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="tab-content" id="tab-notifications">
                            <div class="form-group">
                                <label>Admin Email for Alerts</label>
                                <input type="email" id="adminEmail" class="form-control" placeholder="admin@chartwise.com">
                            </div>
                            <div class="form-group">
                                <label>Notify on New User Registration</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="notifyNewUser">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label>Notify on API Errors</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="notifyApiErrors" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button class="btn btn-primary" id="saveSystemSettings">
                                <i class="fas fa-save"></i> Save Settings
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Logs Page -->
            <div id="page-logs" class="page">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-file-alt"></i> System Logs</h3>
                        <div class="header-actions">
                            <select id="logLevel" class="filter-select">
                                <option value="all">All Levels</option>
                                <option value="error">Error</option>
                                <option value="warn">Warning</option>
                                <option value="info">Info</option>
                            </select>
                            <button class="btn btn-secondary" id="clearLogs">
                                <i class="fas fa-trash"></i> Clear
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="log-container" id="logContainer">
                            <!-- Logs will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- User Edit Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit User</h3>
                <button class="modal-close" onclick="closeModal('userModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editUserId">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="editUsername" class="form-control" readonly>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="editEmail" class="form-control" readonly>
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <select id="editRole" class="form-control">
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Subscription</label>
                    <select id="editSubscription" class="form-control">
                        <option value="free">Free</option>
                        <option value="pro">Pro</option>
                        <option value="enterprise">Enterprise</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Subscription Expiry</label>
                    <input type="date" id="editExpiry" class="form-control">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('userModal')">Cancel</button>
                <button class="btn btn-primary" id="saveUserBtn">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>Confirm Delete</h3>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this user? This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('deleteModal')">Cancel</button>
                <button class="btn btn-danger" id="confirmDelete">Delete</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="admin.js"></script>
</body>
</html>
